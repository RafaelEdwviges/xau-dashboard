<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>XAU/USD Dashboard Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #111; color: white; padding: 20px; }
h1 { text-align: center; }
.dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
.card { background: #1c1c1c; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #333; }
.price { font-size: 2.2rem; font-weight: bold; }
.green { color: #00ff9d; }
.red { color: #ff4e4e; }
.chart-container { margin-top: 25px; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
.news-list { text-align: left; font-size: 0.9rem; line-height: 1.3rem; max-height: 150px; overflow-y: auto; }
canvas { background: #1c1c1c; border-radius: 5px; }
</style>
</head>
<body>

<h1>ğŸ“ˆ Dashboard XAU/USD Premium</h1>

<div class="dashboard">
    <div class="card">
        <div>PreÃ§o Atual</div>
        <div id="price" class="price">Carregando...</div>
    </div>
    <div class="card">
        <div>Sentimento do Mercado</div>
        <div id="sentiment">Carregando...</div>
    </div>
    <div class="card">
        <div>TendÃªncia</div>
        <div id="trend">Carregando...</div>
    </div>
    <div class="card">
        <div>Suporte / ResistÃªncia</div>
        <div id="levels">Carregando...</div>
    </div>
</div>

<div class="chart-container">
<iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_12345&symbol=XAUUSD&interval=15&theme=dark&style=1&timezone=Etc/UTC&withdateranges=true&hide_side_toolbar=true&studies=&hideideas=true" width="100%" height="500" frameborder="0"></iframe>
</div>

<br>

<!-- CalendÃ¡rio EconÃ´mico apenas USD alto impacto -->
<iframe src="https://www.investing.com/economic-calendar/?impact_filter=3&curr_id=1" width="100%" height="300" frameborder="0"></iframe>

<br>
<div class="card" style="margin-top:20px;">
    <h3>ğŸ“° Ãšltimas NotÃ­cias</h3>
    <div id="news" class="news-list">Carregando notÃ­cias...</div>
</div>

<div class="card" style="margin-top:20px;">
  <h3>ğŸ’¹ CorrelaÃ§Ã£o DXY Ã— XAU/USD (7 dias)</h3>
  <div id="correlation">Carregando...</div>
  <canvas id="correlationChart" width="400" height="200"></canvas>
</div>

<script>
setInterval(() => {
 fetch("https://api.exchangerate.host/latest?base=XAU&symbols=USD")
 .then(r => r.json())
 .then(d => {
   let price = (1 / d.rates.USD).toFixed(2);
   document.getElementById("price").innerHTML = price;
 });
}, 3000);

document.getElementById("sentiment").innerHTML = "65% Compra / 35% Venda";
document.getElementById("trend").innerHTML = "H1 â†’ Alta ğŸ“ˆ <br>H4 â†’ Neutro âš–ï¸ <br>D1 â†’ Alta Forte ğŸš€";
document.getElementById("levels").innerHTML = "S1: 2638 <br>S2: 2622 <br>R1: 2675 <br>R2: 2692";

fetch("https://newsdata.io/api/1/news?apikey=pub_51849aabbadc8abc&category=business,world&language=pt")
.then(r => r.json())
.then(d => {
 let list = d.results.slice(0, 5).map(n => `â€¢ ${n.title}`).join("<br><br>");
 document.getElementById("news").innerHTML = list;
});

async function updateCorrelation() {
  try {
    const today = new Date();
    const startDate = new Date(today);
    startDate.setDate(today.getDate() - 7);
    const formatDate = d => d.toISOString().slice(0,10);

    const xauResp = await fetch(`https://api.exchangerate.host/timeseries?start_date=${formatDate(startDate)}&end_date=${formatDate(today)}&base=XAU&symbols=USD`);
    const xauData = await xauResp.json();

    const dates = Object.keys(xauData.rates);
    const xauRates = Object.values(xauData.rates).map(r => r.USD ?? null);

    const dxyRates = xauRates.map((v,i) => {
        if(!v) return null;
        return 100 + (v - xauRates[0])/xauRates[0]*100; // simples aproximaÃ§Ã£o
    });

    const lastXAU = xauRates[xauRates.length-1] ?? 0;
    const lastDXY = dxyRates[dxyRates.length-1] ?? 0;

    let recommendation = "âš–ï¸ Neutro";
    if (lastDXY > 101 && lastXAU < 2650) recommendation = "ğŸ“‰ Venda Ouro";
    if (lastDXY < 99 && lastXAU > 2650) recommendation = "ğŸ“ˆ Compra Ouro";

    document.getElementById("correlation").innerHTML = `
      Ãšltimo DXY (estimado): ${lastDXY.toFixed(2)} <br>
      Ãšltimo XAU/USD: ${lastXAU.toFixed(2)} <br>
      RecomendaÃ§Ã£o: ${recommendation}
    `;

    const xauBadges = xauRates.map((v,i,a)=> i===0?null:v>a[i-1]?'buy':'sell');
    const ctx = document.getElementById('correlationChart').getContext('2d');
    if(window.correlationChartInstance) window.correlationChartInstance.destroy();
    window.correlationChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                { label: 'XAU/USD', data: xauRates, borderColor: '#00ff9d', backgroundColor: 'rgba(0,255,157,0.2)', yAxisID: 'y1', pointBackgroundColor: xauBadges.map(b=> b==='buy'?'#00ff9d':'#ff4e4e') },
                { label: 'DXY (estimado)', data: dxyRates, borderColor: '#ff4e4e', backgroundColor: 'rgba(255,78,78,0.2)', yAxisID: 'y2' }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { color: 'white' } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let dataset = context.dataset;
                            let index = context.dataIndex;
                            let value = context.formattedValue;
                            let prev = index > 0 ? dataset.data[index-1] : value;
                            let delta = prev ? ((value - prev)/prev*100).toFixed(2) : 0;
                            return `${dataset.label}: ${value} (Î”% ${delta}%)`;
                        }
                    }
                }
            },
            scales: {
                y1: { type: 'linear', position: 'left', ticks: { color: '#00ff9d' } },
                y2: { type: 'linear', position: 'right', ticks: { color: '#ff4e4e' }, grid: { drawOnChartArea: false } },
                x: { ticks: { color: 'white' } }
            }
        }
    });
  } catch (e) {
    document.getElementById("correlation").innerHTML = "Erro ao carregar dados.";
  }
}

updateCorrelation();
setInterval(updateCorrelation, 5*60*1000);
</script>
</body>
</html>
