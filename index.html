<!-- ===================== -->
<!-- üóìÔ∏è CALEND√ÅRIO ECON√îMICO -->
<!-- ===================== -->
<section id="economic-calendar" style="margin-top: 40px;">
  <div class="card" style="background-color:#1c1c1c; color:#fff; padding:20px; border-radius:10px;">
    <h3 style="margin-bottom:15px;">üóìÔ∏è Calend√°rio Econ√¥mico (USD - Alta Relev√¢ncia)</h3>
    <table id="calendar-table" style="width:100%; border-collapse: collapse; text-align:left;">
      <thead style="background-color:#333;">
        <tr>
          <th style="padding:8px;">Data</th>
          <th style="padding:8px;">Evento</th>
          <th style="padding:8px;">Pa√≠s</th>
          <th style="padding:8px;">Impacto</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
async function loadCalendar() {
  try {
    const response = await fetch("https://www.econdb.com/api/calendar/?format=json");
    const data = await response.json();
    const filtered = data.results
      .filter(ev =>
        ev.country === "United States" &&
        (ev.importance === "High" || ev.importance === 3)
      )
      .slice(0, 10);

    const tableBody = document.querySelector("#calendar-table tbody");
    tableBody.innerHTML = "";
    filtered.forEach(ev => {
      const date = new Date(ev.date).toLocaleString();
      const row = `
        <tr style="border-bottom:1px solid #333;">
          <td style="padding:8px;">${date}</td>
          <td style="padding:8px;">${ev.event}</td>
          <td style="padding:8px;">${ev.country}</td>
          <td style="padding:8px; color:red; font-weight:bold;">Alta</td>
        </tr>`;
      tableBody.innerHTML += row;
    });
  } catch (error) {
    console.error("Erro ao carregar calend√°rio:", error);
    document.querySelector("#calendar-table tbody").innerHTML =
      "<tr><td colspan='4'>Erro ao carregar dados.</td></tr>";
  }
}
loadCalendar();
setInterval(loadCalendar, 5 * 60 * 1000); // Atualiza a cada 5 minutos
</script>

<!-- =============================== -->
<!-- üíπ CORRELA√á√ÉO DXY √ó XAUUSD -->
<!-- =============================== -->
<section id="dxy-xau" style="margin-top: 40px;">
  <div class="card" style="background-color:#1c1c1c; color:#fff; padding:20px; border-radius:10px;">
    <h3>üíπ Correla√ß√£o DXY √ó XAUUSD (7 dias)</h3>
    <p><strong>Correla√ß√£o:</strong> <span id="corr">Calculando...</span></p>
    <p><strong>Recomenda√ß√£o:</strong> <span id="rec">...</span></p>
    <canvas id="chartDXY" width="350" height="150"></canvas>
    <canvas id="chartXAU" width="350" height="150" style="margin-top:15px;"></canvas>
  </div>
</section>

<!-- Importa Chart.js para gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
async function getYahooData(symbol) {
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=7d&interval=1d`;
  const res = await fetch(url);
  const data = await res.json();
  const result = data.chart.result[0];
  const timestamps = result.timestamp.map(ts => new Date(ts * 1000).toLocaleDateString());
  const closes = result.indicators.quote[0].close.filter(v => v !== null);
  return { timestamps, closes };
}

function pearson(x, y) {
  const meanX = x.reduce((a,b)=>a+b)/x.length;
  const meanY = y.reduce((a,b)=>a+b)/y.length;
  const num = x.map((xi,i)=>(xi-meanX)*(y[i]-meanY)).reduce((a,b)=>a+b);
  const den = Math.sqrt(
    x.map(xi=>(xi-meanX)**2).reduce((a,b)=>a+b) *
    y.map(yi=>(yi-meanY)**2).reduce((a,b)=>a+b)
  );
  return num/den;
}

let chartDXY, chartXAU;

function renderChart(ctx, labels, data, color, title) {
  return new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: title,
        data: data,
        borderColor: color,
        backgroundColor: "transparent",
        borderWidth: 2,
        pointRadius: 2
      }]
    },
    options: {
      scales: { x: { display: false }, y: { display: false } },
      plugins: { legend: { display: false } }
    }
  });
}

async function updateCorrelation() {
  try {
    const dxy = await getYahooData("DX-Y.NYB");
    const xau = await getYahooData("XAUUSD=X");
    const corr = pearson(dxy.closes, xau.closes);
    document.getElementById("corr").innerText = corr.toFixed(2);

    const dxyChange = dxy.closes.at(-1) - dxy.closes.at(-2);
    const xauChange = xau.closes.at(-1) - xau.closes.at(-2);

    let rec = "‚öñÔ∏è Neutro";
    if (dxyChange > 0 && xauChange < 0) rec = "üìâ Venda Ouro";
    else if (dxyChange < 0 && xauChange > 0) rec = "üìà Compra Ouro";

    document.getElementById("rec").innerText = rec;

    // Atualiza mini-gr√°ficos
    if (chartDXY) chartDXY.destroy();
    if (chartXAU) chartXAU.destroy();

    chartDXY = renderChart(document.getElementById("chartDXY"), dxy.timestamps, dxy.closes, "#00ffff", "DXY");
    chartXAU = renderChart(document.getElementById("chartXAU"), xau.timestamps, xau.closes, "#ffd700", "XAUUSD");
  } catch (error) {
    console.error("Erro ao calcular correla√ß√£o:", error);
    document.getElementById("corr").innerText = "Erro";
    document.getElementById("rec").innerText = "Indispon√≠vel";
  }
}

updateCorrelation();
setInterval(updateCorrelation, 5 * 60 * 1000); // Atualiza a cada 5 minutos
</script>
