<script>
  async function getGoldPrice() {
    try {
      const response = await fetch("https://api.metals.live/v1/spot");
      const data = await response.json();
      return data[0][1]; // XAU/USD
    } catch(err) {
      console.log(err);
      return null;
    }
  }

  let prices = [];
  let chart;

  async function update() {
    const price = await getGoldPrice();
    
    if (!price) {
      document.getElementById("price").innerText = "Erro ao obter preÃ§o";
      return;
    }

    document.getElementById("price").innerText = "$ " + price.toFixed(2);

    prices.push(price);
    if (prices.length > 50) prices.shift();

    if (!chart) {
      chart = new Chart(document.getElementById("chart"), {
        type: 'line',
        data: {
          labels: prices.map((_, i) => i + 1),
          datasets: [{
            label: "XAU/USD",
            data: prices,
            borderColor: "gold",
            borderWidth: 3,
            pointRadius: 0
          }]
        },
        options: {
          animations: false,
          scales: { y: { beginAtZero: false } }
        }
      });
    } else {
      chart.data.datasets[0].data = prices;
      chart.update();
    }
  }

  update();
  setInterval(update, 5000);
</script>
