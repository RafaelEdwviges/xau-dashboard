<script>
  async function getGoldPrice() {
    try {
      const response = await fetch("https://data-asg.goldprice.org/dbXRates/USD");
      const data = await response.json();
      return data.items[0].xauPrice; // XAU/USD
    } catch(err) {
      console.log(err);
      return null;
    }
  }

  let prices = [];
  let chart;

  async function update() {
    const price = await getGoldPrice();
    
    if (!price) {
      document.getElementById("status").innerText = "⚠ Erro ao obter preço (tentando novamente...)";
      return;
    }

    document.getElementById("price").innerText = "$ " + price.toFixed(2);
    document.getElementById("status").innerText = "Atualizando a cada 5s ✅";

    prices.push(price);
    if (prices.length > 80) prices.shift();

    if (!chart) {
      chart = new Chart(document.getElementById("chart"), {
        type: 'line',
        data: {
          labels: prices.map((_, i) => i + 1),
          datasets: [{
            label: "XAU/USD Spot",
            data: prices,
            borderColor: "gold",
            borderWidth: 3,
            pointRadius: 0,
            tension: 0.25
          }]
        },
        options: {
          animations: false,
          scales: { y: { beginAtZero: false } },
          plugins: { legend: { labels: { color: "white" } } }
        }
      });
    } else {
      chart.data.datasets[0].data = prices;
      chart.update();
    }
  }

  update();
  setInterval(update, 5000);
</script>
